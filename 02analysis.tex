% !TeX root = thesis.tex

\chap Analysis

This chapter is dedicated to the analysis of various topics related to this thesis. In the first part, current trends in shipments of devices will be introduced. This introduction will be followed by analysis of the latest in-car infotainment solutions including their advantages and disadvantages. Then the basic facts about various types of communication in automotive environment will be explained. The last section of this chapter is devoted to cloud computing topic and its extension to in-vehicular use.

\sec Usage of portable devices

The shipments of portable devices are facing big changes recently. Sales of traditional PCs are decreasing every year. On the other side, the shipments of portable devices (mainly mobile phones and so-called ultramobile devices) are experiencing the opposite trend. As we can see in table~\ref[devices_shipments], the numbers are increasing. According to Gartner~Inc.~\cite[atwal2013forecast] the mobile phone shipments are by far the largest. These numbers suggest what kind of devices are customers use the most and consequently what devices will be most probably used while driving. 
\midinsert \clabel[devices_shipments]{Worldwide Devices Shipments by Device Type, 2014-2017 (Millions of Units)}
\ctable{lrrrr}{
\hfil Device Type & 2014 & 2015 & 2016 & 2017 \crl \tskip4pt
Traditional PCs (Desk-Based and Notebook) & 277 & 251 & 243 & 233 \cr
Ultramobiles\fnote{The {\bf Ultramobile (Premium)} category includes devices such as Microsoft's Windows 8 Intel x86 products and Apple's MacBook Air.} (Premium) & 37 & 49 & 68 & 89 \cr
{\bf PC Market} & {\bf 314} & {\bf 300} & {\bf 311} & {\bf 322} \cr
Ultramobiles (Tablets and Clamshells)\fnote{The {\bf Ultramobile (Tablets and Clamshells)} category includes devices such as, iPad, iPad mini, Samsung Galaxy Tab S 10.5, Nexus 7 and Acer Iconia Tab 8.} & 226 & 214 & 228 & 244 \cr
{\bf Computing Devices Market} & {\bf 540} & {\bf 514} & {\bf 539} & {\bf 566} \cr
Mobile Phones & 1879 & 1940 & 2007 & 2062 \cr
{\bf Total Devices Market }& {\bf 2419} & {\bf 2454} & {\bf 2546} & {\bf 2628} \cr
}
\caption/t Worldwide Devices Shipments by Device Type, 2014-2017 (Millions~of~Units)~\cite[atwal2013forecast]
\endinsert


\sec In-car devices and controls

Driving a car is a stressful task. Distraction is the number one reason for traffic accidents. The reasons are obvious:

\begitems
* Technological development is faster that the ability to handle it. Product life cycle (in automotive environment)  is getting shorter - from more than 4 years to less than 18 months.
* Infotainment systems functionality is increasing, but the human processing capacity is the same.
* Complexity of whole eco system of human mobility is continuously increasing~\cite[wickens1992engineering]:
	\begitems
	* High volume of traffic
	* More miles driven
	* Complex road infrastructure
	* Overusage of road signs
	\enditems
\enditems

Hardware interfaces are a mixture of knobs, buttons, sliders, and switches in the car. These controls are called {\bf Tangible User Interfaces} \cite[ishii2008tangible]. They are the traditional car on touch and physical environment. They allow the driver to control the car. In the last decades the mechanical buttons have changed to electrical switches with micro controllers. The measurement equipment was replaced with screens. The whole car infrastructure became digital. This change is following similar changes in the digital personal devices. 

There are other devices in the car or devices the driver and passengers will bring to the car, which will require wired or wireless connection. First USB, for MP3 players, phone, or it can be used to charge some of the mobile devices while driving. Some cars may provide flash memory slot supporting different types and allowing music playback or allow replication to the in-car hard drive. 

The car may also provide a Wi-Fi connection in several different setups. Other mobile devices the driver and the passengers bring to the car must be considered. The top level car may also provide HDMI for in-car screens located on the dashboard and back seats.


\sec In-car mobile applications

In this section the important vendors of mobile applications aiming for in-car use will be introduces. The two most popular competitors - Android Auto and Apple CarPlay will be presented  in details. Other vendors of applications available on various mobile application stores will be featured.
 
\secc Android Auto

Android Auto is an app that integrates with a car to make it easier for driver to use some of the main features of the Android phone while driving. Driver can control things like navigation, music, and the phone's dialer from the car's digital display so that the driver can stay focused on the road. Android Auto app can be downloaded on Google Play\urlnote{https://play.google.com/store?hl=en}. There is also a need for compatible car or aftermarket unit. Most Android phones running Android 5.0 Lollipop can run Android Auto in a compatible car or aftermarket unit. In addition to the phone itself, Android Auto requires a data connection and a Google Account\urlnote{https://accounts.google.com/SignUp} to download the app from the Google Play Store~\cite[androidauto]. 

Communication with the phone is ensured by USB cable which provides data transfer and recharging capabilities. In-dashboard system uses also the internet data connection from the phone. In figure~\ref[android_auto_golf] is shown the general concept of using the Android Auto ecosystem. In figure~\ref[android_auto_maps] is then shown the navigational feature using Google Maps.

\midinsert \clabel[android_auto_golf]{Android Auto App running in Volkswagen Golf Mk. 6}
\picw=\hsize \cinspic resources/images/android_auto_golf.jpg
\caption/f Android Auto App running in Volkswagen Golf Mk. 6
\endinsert

\midinsert \clabel[android_auto_maps]{Screenshot of Google Maps in Android Auto App}
\picw=10cm \cinspic resources/images/android_auto.jpg
\caption/f Screenshot of Google Maps in Android Auto App
\endinsert

Android Auto concpet is heavily focused on minimizing the driver distraction. Therefore is present only three possibilities to interact with a driver:

\begitems
	*System overview (weather, time, navigation, etc.),
	*audio applications (Google Play Music, Spotify, etc.),
	*messaging application (Messanger, WhatsUp, etc.).
\enditems

\secc Apple CarPlay

Apple CarPlay is the main competitor of Android Auto. It offers a way to use Apple iPhone smartphones in vehicles. An example of integration this system to car is in figure~\ref[apple_carplay]. Key features of Apple CarPlay include the following~\cite[applecarplay]: 
\begitems
	* Maps
	* Messages
	* Phone
	* Music
	* 3rd Party Apps
\enditems

\midinsert \clabel[apple_carplay]{Car dashboard with running Apple CarPlay}
\picw=\hsize \cinspic resources/images/apple_carplay.jpg
\caption/f Car dashboard with running Apple CarPlay
\endinsert

\secc Other vendors

Android Auto and Apple CarPlay are not the only available solutions of infotainment systems. Almost every car manufacturer develops its own solution of IVIS, e.g. BMW ConnectedDrive\urlnote{www.bmw.es/connecteddrive}, Ford Sync\urlnote{www.ford.com/technology/sync} or General Motors' OnStar\urlnote{https://www.onstar.com/us/en/home.html}. Apple's and Google's solutions were chosen because they both offer an open platform for 3rd party developers to publish their applications to well-known application stores.

\sec Data \& comumunication

\secc In-vehicle real-time busses

{\bf Controller Area Network Bus (CAN-BUS)} - Bosch originally developed the Controller Area Network (CAN) in 1985 for in-vehicle networks. In the past, automotive manufacturers connected electronic devices in vehicles using point-to-point wiring systems. As more and more electronics started to be used in vehicles, the situation led to very complex and confusional systems that were heavy and expensive. They then replaced dedicated wiring with in-vehicle networks, which reduced wiring cost, complexity, and weight. CAN is a high-integrity serial bus system for networking intelligent devices, developed as the standard in-vehicle network. Whole automotive industry quickly adopted CAN and it became the international standard in 1993 known as ISO 11898.  \cite[etschberger2001controller]

{\bf FlexRay} - The FlexRay communication bus is a deterministic, fault-tolerant and high-speed bus system developed in conjunction with automobile manufacturers and leading suppliers. FlexRay delivers the error tolerance and time-determinism performance requirements for x-by-wire applications (i.e. drive-by-wire, steer-by-wire, brake-by-wire, etc.). This bus was developed to provide features that CAN cannot offer (e.g. synchronization or high performance)~\cite[ni2009flexray].

\secc On-board Diagnostics (OBD)

The first generation of On-Board Diagnostic requirements, called OBD I, was developed by the California Air Resources Board (ARB) and implemented in 1988. As technology and the desire to expand On-Board Diagnostic capability increased, a second-generation of On-Board Diagnostics requirements was developed. This second version of On-Board Diagnostic capabilities is called \glref{OBDII}. The Clean Air Act Amendments of 1990 mandated that, beginning with the 1996 model year, all light-duty vehicle and trucks made available for sale outside of the state of California must also be equipped with OBDII. In addition, EPA also requires that medium duty vehicles up to 14,000 pounds must also be equipped with OBD II systems beginning in the 2004 model year. In the future, EPA expects that all heavy-duty vehicles over 14,000 pounds will eventually be equipped with OBDII systems.

http://www3.epa.gov/obd/basic.htm

On-Board Diagnostics, or "OBD," is a computer-based system built into all 1996 and later light-duty vehicles and trucks, as required by the Clean Air Act Amendments of 1990. OBD systems are designed to monitor the performance of some of an engine's major components including those responsible for controlling emissions. 
OBD is a valuable tool that assists in the service and repair of vehicles by providing a simple, quick, and effective way to pinpoint problems by retrieving vital automobile diagnostics from the OBD systems.
OBD plays an important role where vehicle inspection and maintenance programs are required.
OBD serves as an early warning system that alerts you to the potential need for vehicle repair through the "Check Engine" light on the dashboard of your vehicle.
OBD systems are required by EPA to be installed on light-duty vehicles and trucks, as well as heavy-duty engines.

(http://www3.epa.gov/obd/)

\secc Other types of communication

As the application supports to communication with a car's \glref{ECU}, it connects to the internet and uploads data logs, various types of communication are taken in account.

\seccc Bluetooth

Bluetooth is wireless technology standard for communication over short distances. It has been used mainly to connect headsets to phones. Nowadays it is gaining more popularity in the Internet of Things.

Support of Bluetooth technology is crucial for the final application. Bluetooth is used for connection to ELM327 Bluetooth Dongle which provides communication with \glref{OBD} interface. Dongles based on ELM327 usually supports USB, RM-232, WiFi or Bluetooth connections. In this case the Bluetooth connection was chosen because of simplicity of usage, commercial availability of the dongles and low power consumption\urlnote{http://science.opposingviews.com/bluetooth-vs-wifi-power-consumption-17630.html}.

\seccc Mobile data communication (3G, 4G)

Category of mobile telecommunication in this case includes the possibilities of connection to the internet when wi-fi connection is not available. To this category belong wireless network technologies provided by mobile carriers (3G, 4G). This type of internet connectivity is not supposed to be used for uploading trip logs due to limited data plans issue. The typical use is to control other devices via HTTP request initiated from the smartphone (e.g., opening garage doors or entrance gates). The application is, however, usable without the data plan.

\secc Wi-fi

Although the Bluetooth connection seems to be an ideal way how to connect to a car's \glref{ECU}, there are devices on the market that support also Wi-Fi connection. The advantage is a bigger bandwidth provided by Wi-Fi (proposed versions Wi-Fi Direct promises 250 Mbps while Bluetooth 4.0 promises 25 Mbps\urlnote{http://www.pcworld.com/article/208778/Wi_Fi_Direct_vs_Bluetooth_4_0_A_Battle_for_Supremacy.html}). This bandwidth can be used to transfer more data from the ECU. However, for the purposes of the final application this difference is not significant, therefore only Bluetooth support is proposed. 


\sec Mobile platforms

Nowadays, mobile devices are shipped with various operating systems.This section introduces the most important mobile operating system's vendors. \rfc{add table to sumarize the sales} \rfc{3 radky min}

\secc Android 

Android is an open source from Google Inc. As it is the most used mobile operating system, it was chosen as the target platform for the purposes of this thesis and it is described in detail in further sections~\cite[androidcom]. 

\secc iOS

iOS (also known as iPhone OS) is being developed by Apple Inc.~\cite[ios] It is closed sourced and proprietary and is supposed to run only on devices produced by Apple Inc - Apple iPhone, iPod Touch, iPad and Apple TV. It allows installing native third party applications.

\secc Windows Phone (Windows 10 Mobile)

Windows Phone is a closed sourced and proprietary mobile operating system from Microsoft~\cite[windowsphone]. It offers rich integration with other serviced provided by Microsoft such as OneDrive, Xbox Music \& Video, Bing and Office. From January 2015 it is re-branded as Windows 10 Phone. 

\secc BlackBerry

BlackBerry (currently version 10) was one of the dominant platform in mobile world once. It is a closed source and proprietary operating system and runs only on devices produced by BlackBerry. By the end of 2014 the market shares were less than half of percent~\cite[blackberryos].

\secc Firefox OS

Firefox OS is from Mozilla~\cite[firefoxos]. It is released under the Mozilla Public License and uses kernel and drivers from Android.  \rfc{3 radky min}

\secc Sailfish OS

Sailfish OS is from finnish company Jolla~\cite[sailfishosorg]. This operating system (and company) was established by former employees of Nokia and its abandoned operating system MeeGo. Sailfish OS is partly open sourced under GPL license.  

\secc Tizen

Linux based operating system Tizen is developed by Linux Foundation~\cite[tizenorg], Tizen Association, Samsung and Intel. It is based on Linux kernel and C library implementing Linux API. It is not only mobile operating system but also targets wide range of devices including smart TVs, smart cameras, wearables, in-vehicle infotainment devices and printers. It is open source software.

\secc Ubuntu Phone OS

Ubuntu Phone is open source OS from Canonical Ltd.~\cite[ubuntuphone] It is a mobile version of desktop OS produced by the same company. It uses kernel and drivers from Android similarly to Firefox OS. 

\sec Android mobile platform

Android is a software stack for mobile devices that includes an operating system, middle ware and key applications. The various components of Android are designed as a stack, with the ‘Applications’ forming the top layer of the stack, while the Linux kernel forms the lowest layer. Android ships with a set of core applications including an e-mail client, SMS program, calendar, maps, browser, contacts, and other features. All applications are written using the Java programming language.

Developers have full access to the same framework APIs used by the core applications. The application architecture is designed to simplify the reuse of components; the capabilities of any application can be published and then be made use of by any other application (subject to security constraints enforced by the framework). The same mechanism allows components to be replaced by the user.

Android includes a set of core libraries that provides most of the functionality available in the core libraries of the Java programming language. Every Android  application runs in its own process, with its own instance of the Dalvik virtual machine. Dalvik has been written so that a device can run multiple VMs efficiently. The Dalvik VM executes files in the Dalvik Executable (.dex) format, which is optimized for minimal memory footprint. The VM is register-based, and runs classes compiled by a Java language compiler that has been transformed into the .dex format by the included dx tool. The Dalvik VM relies on the Linux kernel for underlying functionality such as threading and low-level memory management~\cite[developers2011android]. 

\secc Brief history of Android operating system 

In this subsection a brief history of Android platform~\cite[androidcom] is presented. Knowing the history of the operating system is important to understand further parts of this work. 

\seccc Android 1.0

The very first version of Android was released in October 22nd, 2008 when the first smartphone - T-Mobile G1 launched in the United Stated. This version lacked functionality such as on-screen keyboard (T-Mobile G1 was equipped with hardware keyboard) or multi touch capability. On the other side, many functions that are important even in latest version were introduced: Gmail integration, Android Market or Pull-down notification window. 

\seccc Android 1.1

This version has shown that update of the smartphone's operating system can be quick and painless. \rfc{3 radky}

\seccc Android 1.5 Cupcake

Released in April 2009, half a year after first G1s were shipped, this version added on-screen keyboard, clipboard (copy \& paste) support and video capture and playback. This version also started the 'sweet' naming convention when every version of operating system is named after some dessert starting with letters in alphabetical order. The classical Google's search box was included as well.

\seccc Android 1.6 Donut

Andorid 1.6 added support for CDMA networks which led to increased sales in US and Asia where mobile carriers were running these types of mobile networks. The support for different resolutions was added: QVGA, HVGA, WVGA, FWVGA, qHD and 720p. 

\seccc Android 2.0 / 2.1 Eclair

Released one year after the Android's premiere, this version offered support for multiple Google accounts, Google Maps Navigation, speech to text and new swiping unlock screen. With the Android 2.1, the new stock-Android phone was introduced  - Google Nexus One. 

\seccc Android 2.2 Froyo

Froyo confirmed the position of Nexus phones as Google Nexus One got the upgrade first. This version also added support for mobile hot-spot which was immediately disabled by many carriers. 

\seccc Android 2.3 Gingerbread

Half a year after Froyo, Android 2.3. Gingerbread was released. Beside improvements of keyboard or copy \& paste, Google started to care about battery life. Poorly developed applications had been able to drain phone's battery in very short time. Gingerbread brought tools to monitor battery usage. Another important feature that came with this version was support for front facing cameras and NFC.

\seccc Android 3 Honeycomb

This version was not aimed for usage on phones. The main target were tablets. Google switched from green colors palette to blue one. Honeycomb previewed an important redesign of whole platform's user interface.

\seccc Android 4.0 Ice Cream Sandwich

Android 4.0 was without any doubts the biggest change for the Android ecosystem so far. Majority of graphical elements was redesigned, new bespoke font called Roboto came. 

\seccc Android 4.1 Jelly Bean

Jelly Bean firstly came with the application Google Now which is advanced predictive and question-answering system present in whole Google's platforms. Minor design changes were performed and system applications were improved. Google also started to advertise the Play Store Edition of selected smartphones that offered stock Android running on phones by various manufacturers. This approach was not successful and later Google returned back to Nexus series.

\seccc Android 4.4 KitKat

The main aim for this version was to make Android faster, more efficient and less resource intensive. The Nexus 5 smartphone was firstly released with this version.


\seccc \label[android5] Android 5 Lollipop 

Fistly named just Android L, this version came with so called Material Design. Google wanted to unify user interfaces of 3rd party application and provide guidelines for developers. Android Wear and Android Auto concepts were introduced. 

\seccc Android 6 Marshmallow

In the time of publishing this work. Android 6 is the latest version. It concerns about energy consumption and security of users. Marshmallow allows applications to ask for permission to some resource while using the application. Before that permissions were asked only during installation process.


\sec Cloud computing

The smartphones connected to the internet is the key in the car ecosystem. All smartphone allow access to traditional desktop applications such as \glref{PIM} managers. Most of the downloadable applications are using large databases to store the user’s data and profiles. 

For the purposes of this thesis, cloud computing is used as environment to host the logging server. It offers easy scalability and coverage of different geographical locations as the cloud providers have their datacenters in different part of the world.

\secc The NIST Definition of Cloud Computing

National Institute of Standards and Technology (\glref{NIST}) defined the cloud model as composition of five essential characteristics, three service models and four deployment models~\cite[mell2009nist].

\seccc Essential Characteristics

\begitems
	*{\bf On-demand self-service} - A consumer can change capabilities (processor time, memory, storage etc.) automatically without requiring human interaction,
	*{\bf broad network access} - Capabilities are available over the network using standard mechanisms,
	*{\bf resource pooling} - Provider's computing resources are pooled to serve multiple consumers. These resources are location independent,
	*{\bf rapid elasticity} - Capabilities can be elastically provisioned and released. Capabilities available for provisioning often appear to be unlimited from the consumer's point of view,
	*{\bf measured service} - System controls a optimizes resource usage. The usage of resources is monitored, controlled and reported to provide transparency for provider and consumer of the utilized service.
\enditems

\seccc Service Models

\begitems
	*{\bf Software as a Service (SaaS)} - Consumer uses provider's applications running on a cloud infrastructure. Applications are accessible from various client devices (e.g., web-browser, third party application or API). Consumer does not manage or control underlying cloud infrastructure neither individual application capabilities but can control user specific application configuration,
	*{\bf Platform as a Service (PaaS)} - Consumer has a capability to deploy onto the cloud custom applications created using the environment supported by the provider. Consumer does not manage or control underlying cloud infrastructure but has control over the deployed applications and can configure settings for the application environment,
	*{\bf Infrastructure as a Service (IaaS)} - Consumer provisions directly processing, storage, networks, and other fundamental computing resources where is he able to deploy and run arbitrary software (including operating systems). Customer does not manage the underlying infrastructure but has control over OSs, storage, and deployed applications.
\enditems

\seccc Deployment Models

\begitems
	*{\bf Private cloud} - The cloud infrastructure is provisioned for single organization use. It can be owned directly by the organization or provided by a third party,
	*{\bf community cloud} - The cloud infrastructure is provisioned for the specific single community of consumers. It can be owned by one or more community's member or a third party,
	*{\bf public cloud} - The cloud infrastructure is provided for open use by the general public. It exists on the premises of the cloud provider,
	*{\bf hybrid cloud} - The cloud infrastructure is a composition of two or more previously mentioned models that are bound together by standardized or proprietary technology to enable data and application portability.
	
\enditems

\sec Reference Hardware

\secc Mobile device

Mobile application is supposed to run on wide range of devices available in current market. It does not require any hardware or software customization of target device. It requires Android 5.0 and higher. This version of Android OS is available for majority of current shipped devices.

\seccc LG Nexus 5

LG Nexus 5 was used for the purposes of development and testing. The main reason for selection was the fact, that whole life cycle (design, development, marketing and support) is managed directly by Google, Inc, the vendor of Android OS. Even though the development was aimed to reach the full functionality of as wide range of devices as possible, there can still be minor issues on other devices. 

The technical specification of the device are following~\cite[wiki:nexus5]:

\begitems

*{\bf Codename}: Hammerhead
*{\bf Developer}: Google, LG Electronics
*{\bf Manufacturer}: LG Electronics
*{\bf Compatible networks}: 2G/3G/4G LTE
*{\bf Dimensions}: 137.84 mm H; 69.17 mm W; 8.59 mm D
*{\bf Weight}: 130 g
*{\bf Operating system}: Android 'Marshmallow' 6.0.1
*{\bf System on chip}: Qualcomm Snapdragon 800
*{\bf CPU}: 2.26 GHz quad-core Krait 400
*{\bf GPU}: Ardeno 330, 450 MHz
*{\bf Memory}: 2 GB of LPDDR3-1600 RAM
*{\bf Storage}: 16 GB (12.55 GB available)
*{\bf Display}: 4.95 in (126 mm) Full HD 1920x1080 px (445 ppi) IPS LCD, with Corning Gorilla Glass 3
*{\bf Connectivity}: Micro USB, SlimPort, NFC, Bluetooth 4.0, 2x2 MIMO Wi-Fi 802.11 a/b/g/n/ac (single stream)

\enditems

\midinsert \clabel[nexus5_photo]{LG Nexus 5}
\picw=10cm \cinspic resources/images/Nexus5.jpg
\caption/f LG Nexus 5
\endinsert

\secc OBD II devices

One of the features of mobile application is the ability to gather driving data from \glref{ECU} of the car. For this purpose the application uses standardized solution with \glref{OBD} dongle equipped with ELM327 chip which is connected to car's diagnostic socket.

\seccc MINI ELM327 bluetooth OBD2 V1.5 Bluetooth dongle

This dongle (in figure \ref[dongle_photo]) is widely available and very cheap (\$10 in December 2015) device that can be used with the mobile application. It was used while testing the functionality in real vehicle (Ford Focus, manufactured in 2008). It can be purchased in global online stores such as Amazon\urlnote{https://amazon.com} or Ebay\urlnote{https://ebay.com} as well as in local online stores. Beside the reading features it allows to diagnose trouble codes and display their meaning. It can clear these codes and turn of the `Check Engine` light. These features are not implemented in current version of the mobile application. However, this device suffers from a big problem - it does not disconnect when engine is not running and therefore it may drain the vehicle's battery.

\midinsert \clabel[dongle_photo]{MINI ELM327 bluetooth OBD2 V1.5 Bluetooth dongle}
\picw=10cm \cinspic resources/images/elm327.jpg
\caption/f MINI ELM327 bluetooth OBD2 V1.5 Bluetooth dongle
\endinsert

\seccc OBD PC Emulator
 

