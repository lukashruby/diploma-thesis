% !TeX root = thesis.tex


\chap Implementation

In this chapter the main information about development of the project will be introduced. Firstly, used developer tools will be presented. The Android application and logging server structures will follow. At the end of the chapter will be a section about difficulties and problems and their solutions. 


\sec{Development environments}

\secc{Android SDK}

The Android SDK is a set of various tools that help developers to develop mobile applications for the Android platform. The tools are divided into two groups: SDK tools and platform tools. SDK tools are independent on target Android platform, platform tools are customizes to support concrete version of Android OS~\cite[androidsdkhelp].

To SDK tools belongs Virtual device tools (such as Android Virtual Device Manager or Android Emulator), Development tools (such as SQLite DB Explorer, SDK Manager or Translation editors), Debugging tools (Android Monitor, Android Debug Bridge, etc.), Build and Image tools. \rfc{jak je to s tema platform tools, patri tam adb nebo ne?}

\secc{Java Platform, Enterprise Edition}

Java Platform, Enterprise edition (Java EE) is the standard in community-driven enterprise software. Java EE is developed using the Java Community Process\urlnote{http://www.jcp.org/} with contributions from industry experts, commercial and open source organizations and many individual developers. Nowadays there are more than 20 compliant Java EE implementation~\cite[javaee].

\secc{Java Platform, Standard Edition}

\rfc{co je to vlastne java? tady uz to nebude tak lehky - existuje i neco jako SE Advanced edition, ktera je placena} \cite[javase]


\sec Development tools

\rfc{sth common about dev tools}


\secc Integrated development environment

For the purpose of this thesis was used the offical IDE for Android application development provided by Google - Android Studio. Android studio is based on IntelliJ IDEA, a commercial product
by the company JetBrains s.r.o.. Beside the standard set of functions from IntelliJ IDEA, Android Studio offers tailored-made extensions for Android application developers, therefore is the recommended option to start the development with. \rfc{cite source}

\secc Code version control system

Version control is a system that records changes to a file or set of files over time so that user can recall specific version later. Version control is mostly used in software development process to manage diffrent versions of source code. But \glref{VCS} is not limited only to plain text information. Graphics and other multimedia can be versioned as well~\cite[torvalds2010git].

There are three main approaches in version controlling:

\begitems
	* {\bf Local Version Control Systems} - all changes are stored only on the single computer used by user (e.g., simple file copying to other folder),
	* {\bf Centralized Version Control Systems} - versions are stored on the server and all clients access it from remote locations (e.g., Subversion, CVS),
	* {\bf Distributed Version Control Systems} - versions are stored on the server, but all cliets have local copy of the repository and are able to make changes independently (e.g., Git or Mercurial).
\enditems

\seccc Git

For the purpose of development the application, Git \glref{VCS} was chosen. Git was founded in 2005 by the Linux development comunnity (in particular Linus Torvalds, the creator of Linux) to be an alternative to the commercial product BitKeeper which was used as \glref{VCS} for development of the Linux kernel. The main objectives were~\cite[githistory]:

\begitems
	* Speed,
	* Simple design,
	* Strong support for non-linear development (thousants of parallel branches),
	* Fully distributed,
	* Ability to handle large projects like the Linux kernel.
\enditems

\seccc GitHub

GitHub\urlnote{https://github.com/} is a web-based Git repository hosting service. It was used for all developed software applications and tools in this thesis:

\begitems
	* Android application for smartphone\urlnote{https://github.com/eclubprague/CarDashboardPhone}
	* Shared core for Android platform\urlnote{https://github.com/eclubprague/CarDashboardCore}
	* Logging server\rfc{add logging server to git!}
	* OBD Bluetooth Emulation tool\urlnote{https://github.com/lukashruby/obd-mocked-bluetooth-dongle}
	* Thesis \TeX~source\urlnote{https://github.com/lukashruby/diploma-thesis}
\enditems

\secc Continuous integration service

Travis CI \rfc{todo}

\secc Build automation system

Graddle \rfc{todo}

\sec{Third party libraries}

During the development of the application and logging server were used also the third party libraries. The following list contains name of each library (or dependency) and reason why it was used in the project:

\begitems
	*https://github.com/bauerca/drag-sort-listview
	
	*com.github.pires:obd-java-api:1.0-RC6
	*com.squareup.okhttp:okhttp:2.5.0
	
	*commons-fileupload
	*org.mongodb.mongodb-driver
	
\enditems


\secc Mobile application

\rfc{todo}

\secc Logging service

\rfc{todo}

\sec Mobile Application Implementation

Mobile application is into two parts. The first part is platform dependent (smartphone in this case) and will be  described in detail in section~\ref[cdphone]. The second part, so-called {\bf Core}, is platform independent and can be ported to other devices which use Android OS (tablet, smart tv, etc.) In~\cite[blaha] is this part used in tablet version of this application. {\bf Core} was developed in cooperation with the author of \cite[blaha]. Details of the contribution is available in Core's Github repository\urlnote{https://github.com/eclubprague/CarDashboardCore}. From this part of project, only the important parts will be described in~\ref[core].

\label[cdphone]
\secc User interface for smartphones

Design of the user interface was the most imporant part of chapter \ref[design] a it is key problem of whole project. As this application is aimed to be used in car while driving, bad implementation of the concept can cause many difficulties for drivers. Therefore was very important to be especially precious in the development and this phase took majority of time.

Standard mode of application consists of various {\bf Modules}. Mobile phone version displays only one module at time (tablet version \cite[blaha] contains more modules at the screen). These modules are ordered in three structure - single module is displaying some information or contains more modules. 

Beside of the standard mode of application, when phone is placed firmly in holder and a driver uses single finger to change views, there is also the configuration mode. In the configuration mode are options to enable or disable {\em Bluetooth support} (for connection to OBD II Dongle) and to configure {\em Bluetooth devices}. Also the settings of {\em Logging features} is present in this mode. Last but not least function is {\em Module management}.
Each part of the application will be described in dedicated subsections.

\seccc ScreenSlideActivity \& ScreenSlidePageFragment

Prevailing part of user interface is the implementation of vertical scrolling list of modules in {\tt ScreenSlideActivity}. This list is presented as infinite menu (after last item in list comes the first one in loop). Android provides support only for horizontal scrolling list, so this implementation was done from scratch. {\tt ScreenSlidePageFragment} is then the content of single Module. It is consisted od Module name, Module icon, Module value and Module units.


\seccc DnDActivity \& DnDFragment

DnD means in this case abbreviation for Drag and Drop. This feature is used in configuration part, where user can change order of modules, add new modules and delete modules with simple swiping gestures. This approach makes the configuration process easy and straightforward.

\label[core]
\secc Shared Core Library

%\rfc{module adding - simplicity, updating, persistence, obdservice, logging}

\secc Final application

\midinsert
\line{\hsize=.5\hsize \vtop{%
      \clabel[module.speed]{Module displays single information.}
      \picw=5cm \cinspic resources/images/screenshots/speed.png
      \caption/f Module displaying single information.
   \par}\vtop{%
      \clabel[module.folder]{Module contains another set of child modules - folder.}
      \picw=5cm \cinspic resources/images/screenshots/folder.png
      \caption/f Module contains another set of child modules - folder.
   \par}}
\endinsert

\midinsert
\line{\hsize=.5\hsize \vtop{%
      \clabel[module.swipe]{Swiping between different modules.}
      \picw=5cm \cinspic resources/images/screenshots/swipe.png
      \caption/f Swiping between different modules.
   \par}\vtop{%
      \clabel[module.btdev]{Selection of Bluetooth device to connect to OBD dongle.}
      \picw=5cm \cinspic resources/images/screenshots/btdev_selection.png
      \caption/f Selection of Bluetooth device to connect to OBD dongle.
   \par}}
\endinsert

\midinsert
\line{\hsize=.5\hsize \vtop{%
      \clabel[module.change]{Changing position of module using Drag and drop.}
      \picw=5cm \cinspic resources/images/screenshots/dnd_change_position.png
      \caption/f Changing position of module using Drag and drop.
   \par}\vtop{%
      \clabel[module.remove]{Removing module using simple swipe gesture.}
      \picw=5cm \cinspic resources/images/screenshots/dnd_remove.png
      \caption/f Removing module using simple swipe gesture.
   \par}}
\endinsert


\sec Server implementation

An important part of the assignment of this thesis is implementation of a logging server. Purpose of the server is to gather data from devices with installed mobile application and provide these data to further exploration. 
Server was implemented as HTTP service in Java EE using Servlet API. It can be deployed to various application servers such as Apache Tomcat or Oracle Glassfish. Oracle Glassfish was used for deployment in this thesis. 

\secc Communication with server

Mobile application is logging all OBD data to the file stored in local storage. As these logs may be very data intensive, it is not reasonable to upload them live. Therefore when a wi-fi connection is availabe, user can initiate the upload of all files.  

\sec Reference Hardware

\secc Mobile device

Mobile application is supposed to run on wide range of devices available in current market. It does not required any hardware or software customization of target device. It requires Android 5.0 and higher. This version of Android OS is available for majority of current shipped devices.

\seccc LG Nexus 5

LG Nexus 5 was used for the purposes of development and testing. The main reason for selection was the fact, that whole lifcycle (design, development, marketing and support) is managed direcly by Google, Inc, the vendor of Android OS. Even though the development was aimed to reach the full functionality of as wide range of devices as possible, there can still be minor issues on other devices. 

The technical specification of the device are following~\cite[wiki:nexus5]:

\begitems

*{\bf Codename}: Hammerhead
*{\bf Developer}: Google, LG Electronics
*{\bf Manufacturer}: LG Electronics
*{\bf Compatible networks}: 2G/3G/4G LTE
*{\bf Dimensions}: 137.84 mm H; 69.17 mm W; 8.59 mm D
*{\bf Weight}: 130 g
*{\bf Operating system}: Android 'Marshmallow' 6.0.1
*{\bf System on chip}: Qualcomm Snapdragon 800
*{\bf CPU}: 2.26 GHz quad-core Krait 400
*{\bf GPU}: Adreno 330, 450 MHz
*{\bf Memory}: 2 GB of LPDDR3-1600 RAM
*{\bf Storage}: 16 GB (12.55 GB available)
*{\bf Display}: 4.95 in (126 mm) Full HD 1920x1080 px (445 ppi) IPS LCD, with Corning Gorilla Glass 3
*{\bf Connectivity}: Micro USB, SlimPort, NFC, Bluetooth 4.0, 2x2 MIMO Wi-Fi 802.11 a/b/g/n/ac (single stream)

\enditems

\midinsert \clabel[nexus5_photo]{LG Nexus 5}
\picw=10cm \cinspic resources/images/Nexus5.jpg
\caption/f LG Nexus 5
\endinsert

\secc OBD II devices

One of the features of mobile application is the ability to gather driving data from ECU of the car. For this purpose the application uses standardized solution with OBD dongle equipped with ELM327 chip which is connected to car's diagnostic outlet /rfc{jiny slovo?}. 

\seccc MINI ELM327 bluetooth OBD2 V1.5 Bluetooth dongle

This dongle (in figure \ref[dongle_photo]) is widely available and very cheap (\$10 in December 2015) device that can be used with the mobile application. It was used while testing the functionality in real vehicle (Ford Focus, manufactured in 2008). It can be purchased in global online stores such as Amazon\urlnote{https://amazon.com} or Ebay\urlnote{https://ebay.com} as well as in local online stores. Beside the reading features it allows to diagnose trouble codes and display their meaning. It can clear these codes and turn of the `Check Engine` light. These features are not implemented in current version of the mobile application. However, this device suffers from a big problem - it does not disconnect when engine is not running and therefore it may drain the vehicle's battery.

\midinsert \clabel[dongle_photo]{MINI ELM327 bluetooth OBD2 V1.5 Bluetooth dongle}
\picw=10cm \cinspic resources/images/elm327.jpg
\caption/f MINI ELM327 bluetooth OBD2 V1.5 Bluetooth dongle
\endinsert

\seccc OBD PC Emulator
 





